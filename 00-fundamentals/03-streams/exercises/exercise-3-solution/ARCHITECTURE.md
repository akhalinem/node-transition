# Exercise 3: Complete Architecture Diagram

## ğŸ”„ Full Upload Flow with Retry Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT SIDE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  1. User selects file: test.pdf (50 MB)                            â”‚
â”‚     â†“                                                               â”‚
â”‚  2. Create ReadStream from file                                    â”‚
â”‚     â†“                                                               â”‚
â”‚  3. Create SHA256 hash (client-side checksum)                      â”‚
â”‚     â†“                                                               â”‚
â”‚  4. Start HTTP POST to http://localhost:3000/upload                â”‚
â”‚     â”‚                                                               â”‚
â”‚     â”œâ”€â–º Stream chunks to server                                    â”‚
â”‚     â””â”€â–º Update hash with each chunk                                â”‚
â”‚                                                                     â”‚
â”‚  5. Listen for Server-Sent Events (SSE)                            â”‚
â”‚     â”‚                                                               â”‚
â”‚     â”œâ”€â–º "progress" events (throttled to 1%)                        â”‚
â”‚     â”‚   â””â”€â–º Update progress bar, speed, ETA                        â”‚
â”‚     â”‚                                                               â”‚
â”‚     â”œâ”€â–º "complete" event                                           â”‚
â”‚     â”‚   â””â”€â–º Receive server checksum                                â”‚
â”‚     â”‚                                                               â”‚
â”‚     â””â”€â–º "error" event                                              â”‚
â”‚         â””â”€â–º Determine if retryable                                 â”‚
â”‚                                                                     â”‚
â”‚  6. On Upload Complete:                                            â”‚
â”‚     â”œâ”€â–º Finalize client checksum                                   â”‚
â”‚     â”œâ”€â–º Compare with server checksum                               â”‚
â”‚     â””â”€â–º Display verification result                                â”‚
â”‚                                                                     â”‚
â”‚  7. On Error (Network/Server):                                     â”‚
â”‚     â”œâ”€â–º Check error code                                           â”‚
â”‚     â”œâ”€â–º If retryable & retry < 3:                                  â”‚
â”‚     â”‚   â”œâ”€â–º Wait: 1s â†’ 2s â†’ 4s (exponential)                       â”‚
â”‚     â”‚   â””â”€â–º Retry from step 2                                      â”‚
â”‚     â””â”€â–º Else: Fail with error message                              â”‚
â”‚                                                                     â”‚
â”‚  8. On Cancellation (Ctrl+C):                                      â”‚
â”‚     â”œâ”€â–º Call req.destroy()                                         â”‚
â”‚     â””â”€â–º Exit gracefully                                            â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â†• HTTP POST
                              â†• SSE Events

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SERVER SIDE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  1. Receive POST /upload                                           â”‚
â”‚     â”œâ”€â–º Extract X-Filename header                                  â”‚
â”‚     â””â”€â–º Sanitize filename                                          â”‚
â”‚                                                                     â”‚
â”‚  2. Set up SSE response headers                                    â”‚
â”‚     â”œâ”€â–º Content-Type: text/event-stream                            â”‚
â”‚     â”œâ”€â–º Cache-Control: no-cache                                    â”‚
â”‚     â””â”€â–º Connection: keep-alive                                     â”‚
â”‚                                                                     â”‚
â”‚  3. Create upload pipeline:                                        â”‚
â”‚                                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚  IncomingMessage (req)                         â”‚             â”‚
â”‚     â”‚  â€¢ Raw HTTP request body stream                â”‚             â”‚
â”‚     â”‚  â€¢ Emits 'data' events with chunks             â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                       â†“                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚  SizeValidator Transform                       â”‚             â”‚
â”‚     â”‚  â€¢ Track: bytesReceived                        â”‚             â”‚
â”‚     â”‚  â€¢ If bytesReceived > MAX_FILE_SIZE:           â”‚             â”‚
â”‚     â”‚    â””â”€â–º Emit error: FILE_TOO_LARGE              â”‚             â”‚
â”‚     â”‚  â€¢ this.push(chunk) - pass through             â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                       â†“                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚  ChecksumTransform                             â”‚             â”‚
â”‚     â”‚  â€¢ Create: crypto.createHash('sha256')         â”‚             â”‚
â”‚     â”‚  â€¢ On chunk: hash.update(chunk)                â”‚             â”‚
â”‚     â”‚  â€¢ On finish: save hash.digest('hex')          â”‚             â”‚
â”‚     â”‚  â€¢ this.push(chunk) - pass through             â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                       â†“                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚  ProgressTransform                             â”‚             â”‚
â”‚     â”‚  â€¢ Track: bytesReceived, totalSize             â”‚             â”‚
â”‚     â”‚  â€¢ Calculate: speed, ETA, percent              â”‚             â”‚
â”‚     â”‚  â€¢ If percent increased by 1%:                 â”‚             â”‚
â”‚     â”‚    â””â”€â–º Emit SSE "progress" event               â”‚             â”‚
â”‚     â”‚  â€¢ this.push(chunk) - pass through             â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                       â†“                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚  WriteStream (fs.createWriteStream)            â”‚             â”‚
â”‚     â”‚  â€¢ Path: ./uploads/<filename>                  â”‚             â”‚
â”‚     â”‚  â€¢ Write chunks to disk                        â”‚             â”‚
â”‚     â”‚  â€¢ Handle backpressure                         â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                     â”‚
â”‚  4. On Pipeline Complete:                                          â”‚
â”‚     â”œâ”€â–º Get checksum from checksumTransform                        â”‚
â”‚     â”œâ”€â–º Get final size from progressTransform                      â”‚
â”‚     â”œâ”€â–º Send SSE "complete" event:                                 â”‚
â”‚     â”‚   â””â”€â–º { filename, size, checksum }                           â”‚
â”‚     â””â”€â–º End response                                               â”‚
â”‚                                                                     â”‚
â”‚  5. On Error:                                                      â”‚
â”‚     â”œâ”€â–º Delete partial file (fs.unlink)                            â”‚
â”‚     â”œâ”€â–º Send SSE "error" event:                                    â”‚
â”‚     â”‚   â””â”€â–º { code, message }                                      â”‚
â”‚     â””â”€â–º End response with error status                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Retry Logic Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Client Retry State Machine                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  uploadWithRetry(file)                                      â”‚
â”‚         â†“                                                   â”‚
â”‚    retryCount = 0                                           â”‚
â”‚         â†“                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚  Try Upload      â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚           â”‚                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                           â”‚
â”‚     â”‚           â”‚                                           â”‚
â”‚  Success?     Error?                                        â”‚
â”‚     â”‚           â”‚                                           â”‚
â”‚     â†“           â†“                                           â”‚
â”‚  Return    Check Error Type                                 â”‚
â”‚            â”‚                                                â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚      â”‚            â”‚                                         â”‚
â”‚  Retryable?  Non-Retryable?                                 â”‚
â”‚      â”‚            â”‚                                         â”‚
â”‚      â†“            â†“                                         â”‚
â”‚  retry < 3?    Throw Error                                  â”‚
â”‚      â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”´â”€â”€â”€â”                                                  â”‚
â”‚  â”‚  Yes  â”‚  No                                              â”‚
â”‚  â†“       â†“                                                  â”‚
â”‚  â”‚   Throw Error                                            â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â–º delay = 1000 * 2^retryCount                            â”‚
â”‚  â”‚   (1s, 2s, 4s)                                           â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â–º Log: "Retrying in Xs..."                               â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â–º await sleep(delay)                                     â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â–º retryCount++                                           â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€â–º Loop back to "Try Upload"                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Memory Flow & Backpressure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Memory Usage During 1 GB Upload                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  File Size: 1 GB                                             â”‚
â”‚  Memory Used: ~50 MB (constant)                              â”‚
â”‚                                                              â”‚
â”‚  How?                                                        â”‚
â”‚                                                              â”‚
â”‚  1. ReadStream reads in chunks (default 64 KB)              â”‚
â”‚     â†“                                                        â”‚
â”‚  2. Chunk flows through pipeline                            â”‚
â”‚     â†“                                                        â”‚
â”‚  3. WriteStream writes to disk                              â”‚
â”‚     â†“                                                        â”‚
â”‚  4. Memory freed, next chunk read                           â”‚
â”‚                                                              â”‚
â”‚  Backpressure Mechanism:                                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ReadStream  â”‚ â”€â”€â”€â–º â”‚ Transform   â”‚ â”€â”€â”€â–º â”‚ WriteStream â”‚  â”‚
â”‚  â”‚   (Fast)    â”‚      â”‚  (Medium)   â”‚      â”‚   (Slow)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  If WriteStream is slow:                                    â”‚
â”‚    â†“                                                        â”‚
â”‚  Transform internal buffer fills                            â”‚
â”‚    â†“                                                        â”‚
â”‚  Transform returns false from push()                        â”‚
â”‚    â†“                                                        â”‚
â”‚  ReadStream pauses automatically                            â”‚
â”‚    â†“                                                        â”‚
â”‚  When WriteStream catches up:                               â”‚
â”‚    â†“                                                        â”‚
â”‚  Transform emits 'drain'                                    â”‚
â”‚    â†“                                                        â”‚
â”‚  ReadStream resumes automatically                           â”‚
â”‚                                                              â”‚
â”‚  Result: Memory stays constant!                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Checksum Verification Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Dual Checksum Calculation                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  CLIENT SIDE:                      SERVER SIDE:             â”‚
â”‚                                                             â”‚
â”‚  1. Create hash                    1. Create hash           â”‚
â”‚     hash = createHash('sha256')       hash = createHash()   â”‚
â”‚                                                             â”‚
â”‚  2. Read file stream               2. Receive HTTP stream   â”‚
â”‚     â†“                                  â†“                    â”‚
â”‚  3. Update hash per chunk          3. Update hash per chunk â”‚
â”‚     stream.on('data', chunk =>        transform._transform() â”‚
â”‚       hash.update(chunk))               hash.update(chunk)  â”‚
â”‚                                                             â”‚
â”‚  4. Finalize on end                4. Finalize on finish    â”‚
â”‚     stream.on('end', () =>            transform._final(() => â”‚
â”‚       checksum = hash.digest())         checksum = hash...)  â”‚
â”‚                                                             â”‚
â”‚  5. Receive server checksum        5. Send in SSE event     â”‚
â”‚     â† â† â† â† â† â† â† â† â† â† â† â† â† â† â† â† â† â†                  â”‚
â”‚                                                             â”‚
â”‚  6. Compare checksums                                       â”‚
â”‚     if (client === server)                                  â”‚
â”‚       âœ… Match! Integrity verified                          â”‚
â”‚     else                                                    â”‚
â”‚       âŒ Mismatch! File corrupted                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Progress Throttling Mechanism

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Progress Event Throttling (1% Increments)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Without Throttling:                                        â”‚
â”‚    File: 100 MB, Chunk: 64 KB                               â”‚
â”‚    Total Chunks: ~1,562                                     â”‚
â”‚    Progress Events: 1,562 (floods client!)                  â”‚
â”‚                                                             â”‚
â”‚  With Throttling:                                           â”‚
â”‚    Track: lastReportedPercent = 0                           â”‚
â”‚                                                             â”‚
â”‚    On each chunk:                                           â”‚
â”‚      currentPercent = (bytes / total) * 100                 â”‚
â”‚                                                             â”‚
â”‚      if (currentPercent - lastReportedPercent >= 1.0)       â”‚
â”‚        â”œâ”€â–º Send SSE progress event                          â”‚
â”‚        â””â”€â–º lastReportedPercent = currentPercent             â”‚
â”‚      else                                                   â”‚
â”‚        â””â”€â–º Skip (don't send event)                          â”‚
â”‚                                                             â”‚
â”‚    Result: Exactly 100 progress events                      â”‚
â”‚            (0%, 1%, 2%, ..., 99%, 100%)                     â”‚
â”‚                                                             â”‚
â”‚  Benefits:                                                  â”‚
â”‚    âœ… Prevents client overload                              â”‚
â”‚    âœ… Smooth progress bar animation                         â”‚
â”‚    âœ… Reduced network traffic                               â”‚
â”‚    âœ… Better UI responsiveness                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¡ Server-Sent Events (SSE) Protocol

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SSE Message Format                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  HTTP Response Headers:                                     â”‚
â”‚    Content-Type: text/event-stream                          â”‚
â”‚    Cache-Control: no-cache                                  â”‚
â”‚    Connection: keep-alive                                   â”‚
â”‚                                                             â”‚
â”‚  Message Format:                                            â”‚
â”‚    data: {"type":"progress","percent":45,...}\n             â”‚
â”‚    \n                                                       â”‚
â”‚                                                             â”‚
â”‚  Example Stream:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ data: {"type":"progress","percent":1}  â”‚                 â”‚
â”‚  â”‚                                        â”‚                 â”‚
â”‚  â”‚ data: {"type":"progress","percent":2}  â”‚                 â”‚
â”‚  â”‚                                        â”‚                 â”‚
â”‚  â”‚ ...                                    â”‚                 â”‚
â”‚  â”‚                                        â”‚                 â”‚
â”‚  â”‚ data: {"type":"progress","percent":99} â”‚                 â”‚
â”‚  â”‚                                        â”‚                 â”‚
â”‚  â”‚ data: {"type":"complete","checksum":â€¦} â”‚                 â”‚
â”‚  â”‚                                        â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                             â”‚
â”‚  Client Parsing:                                            â”‚
â”‚    res.on('data', chunk => {                                â”‚
â”‚      lines = chunk.split('\n')                              â”‚
â”‚      lines.forEach(line => {                                â”‚
â”‚        if (line.startsWith('data: '))                       â”‚
â”‚          data = JSON.parse(line.substring(6))               â”‚
â”‚          handle(data.type)                                  â”‚
â”‚      })                                                     â”‚
â”‚    })                                                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ User Experience Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Terminal Output Example                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  $ node test-client.js document.pdf                         â”‚
â”‚                                                             â”‚
â”‚  ğŸ“¤ Uploading: document.pdf                                 â”‚
â”‚  ğŸ“ Size: 25.50 MB                                          â”‚
â”‚  ğŸ” Calculating client checksum...                          â”‚
â”‚                                                             â”‚
â”‚  ğŸ“¡ Response status: 200                                    â”‚
â”‚                                                             â”‚
â”‚  ğŸ“Š [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 45% | 5.23 MB/s | ETA: 2s    â”‚
â”‚                                                             â”‚
â”‚  (Progress updates in place - no scrolling)                 â”‚
â”‚                                                             â”‚
â”‚  ğŸ“Š [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%         â”‚
â”‚                                                             â”‚
â”‚  âœ… Upload successful!                                      â”‚
â”‚     File: document.pdf                                      â”‚
â”‚     Size: 25.50 MB                                          â”‚
â”‚     Server SHA256: abc123...                                â”‚
â”‚     Client SHA256: abc123...                                â”‚
â”‚     âœ… Checksums match! File integrity verified.            â”‚
â”‚                                                             â”‚
â”‚  ğŸ Upload complete                                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Error with Retry Example                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  $ node test-client.js document.pdf                         â”‚
â”‚                                                             â”‚
â”‚  ğŸ“¤ Uploading: document.pdf                                 â”‚
â”‚  ğŸ“ Size: 25.50 MB                                          â”‚
â”‚  ğŸ” Calculating client checksum...                          â”‚
â”‚                                                             â”‚
â”‚  âš ï¸  Upload failed: connect ECONNREFUSED                    â”‚
â”‚  â³ Retrying in 1 seconds...                                â”‚
â”‚                                                             â”‚
â”‚  ğŸ”„ Retry attempt 1/3                                       â”‚
â”‚                                                             â”‚
â”‚  ğŸ“¤ Uploading: document.pdf                                 â”‚
â”‚  ğŸ“ Size: 25.50 MB                                          â”‚
â”‚  ğŸ” Calculating client checksum...                          â”‚
â”‚                                                             â”‚
â”‚  âš ï¸  Upload failed: connect ECONNREFUSED                    â”‚
â”‚  â³ Retrying in 2 seconds...                                â”‚
â”‚                                                             â”‚
â”‚  (Continues for 3 retries total...)                         â”‚
â”‚                                                             â”‚
â”‚  âŒ Upload failed after 3 retries: connect ECONNREFUSED     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Architecture Status**: âœ… Complete
**All Components**: Integrated and tested
**Documentation**: Comprehensive
